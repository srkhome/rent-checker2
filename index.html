<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>租金區間試算表（簡易版）</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,"PingFang TC","Heiti TC",sans-serif;margin:20px}
    label{display:block;margin-top:10px;font-size:14px}
    input,select,button{padding:6px 10px;font-size:14px;margin-top:4px}
    button{cursor:pointer}
    fieldset{border:1px solid #ddd;border-radius:10px;padding:12px;margin-top:12px}
    legend{font-size:13px;color:#555;padding:0 6px}
    .result{margin-top:20px;font-size:40px;font-weight:bold}
    .ok{color:green}
    .warn{color:red}
    .detail{margin-top:8px;font-size:16px;color:#333;line-height:1.8}
    .muted{color:#666}
    .note{margin-top:20px;color:red;font-size:14px;font-weight:bold}
  </style>
</head>
<body>
  <h1>租金區間試算表（簡易版）</h1>

  <form id="rentForm">
    <label>行政區
      <select id="district" required>
        <option value="">— 請選擇 —</option>
        <option>北屯區</option><option>西屯區</option><option>北區</option><option>南屯區</option>
        <option>南區</option><option>中區</option><option>西區</option><option>東區</option>
        <option>烏日區</option><option>大里區</option><option>太平區</option><option>潭子區</option>
        <option>豐原區</option><option>霧峰區</option><option>大雅區</option><option>沙鹿區</option>
        <option>龍井區</option><option>后里區</option><option>梧棲區</option><option>清水區</option>
        <option>大肚區</option><option>神岡區</option><option>大甲區</option><option>外埔區</option>
        <option>石岡區</option><option>東勢區</option><option>新社區</option><option>和平區</option>
        <option>其它</option>
      </select>
    </label>

    <label>屋齡（年）
      <input id="age" type="number" min="0" max="200" required>
    </label>

    <label>坪數（可輸入小數點兩位）
      <input id="pings" type="number" min="0" step="0.01" required>
    </label>

    <label>現在租金
      <input id="currentRent" type="number" min="0" step="1" required>
    </label>

    <button type="submit">送出</button>
  </form>

  <div id="result" class="result"></div>
  <div id="detail" class="detail"></div>
  <div id="note" class="note"></div>

<script>
// --- 單價表：依你提供的兩張新表 ---
// ageBands index: 0:0–4, 1:5–9, 2:10–14, 3:15–19, 4:20–24, 5:25–29, 6:30–34, 7:35–39, 8:40+

const STUDIO_TABLE = {
  "北屯區":[1120,1100,1080,1055,1025,1000,970,930,885],
  "西屯區":[1110,1090,1070,1045,1015,990,960,920,875],
  "北區":[1060,1040,1025,995,970,945,920,880,840],
  "南屯區":[1060,1040,1025,995,970,945,920,880,840],
  "南區":[1045,1030,1010,985,960,935,905,870,830],
  "中區":[1045,1030,1010,985,960,935,905,870,830],
  "西區":[1010,995,975,950,925,900,875,840,800],
  "東區":[1010,995,975,950,925,900,875,840,800],
  "烏日區":[940,925,905,885,860,835,815,780,745],
  "大里區":[955,900,885,860,840,815,795,760,725],
  "太平區":[915,900,885,860,840,815,795,760,725],
  "潭子區":[900,875,860,840,815,795,770,740,705],
  "豐原區":[900,875,860,840,815,795,770,740,705],
  "霧峰區":[890,875,860,840,815,795,770,740,705],
  "大雅區":[890,875,860,840,815,795,770,740,705],
  "沙鹿區":[870,855,840,820,800,780,755,720,690],
  "龍井區":[870,855,840,820,800,780,755,720,690],
  "后里區":[855,840,825,805,785,760,740,710,675],
  "梧棲區":[840,830,815,795,775,750,730,700,665],
  "清水區":[840,830,815,795,775,750,730,700,665],
  "大肚區":[830,815,805,780,760,740,720,690,660],
  "神岡區":[840,830,815,795,775,750,730,700,665],
  "大甲區":[720,710,700,680,660,645,625,600,570],
  "外埔區":[720,710,700,680,660,645,625,600,570],
  "石岡區":[590,580,570,555,540,525,510,490,470],
  "東勢區":[590,580,570,555,540,525,510,490,470],
  "新社區":[485,480,475,465,455,440,430,410,390],
  "和平區":[480,475,465,455,445,430,420,400,380],
  "其它":[385,380,375,365,355,345,335,320,305]
};

const HOUSE_TABLE = {
  "北屯區":[940,925,905,885,860,835,815,780,745],
  "西屯區":[900,885,870,850,830,805,780,750,715],
  "北區":[900,885,870,850,830,805,780,750,715],
  "南屯區":[900,885,870,850,830,805,780,750,715],
  "南區":[890,875,860,840,815,795,770,740,705],
  "中區":[890,875,860,840,815,795,770,740,705],
  "西區":[830,815,805,780,760,740,720,690,660],
  "東區":[830,815,805,780,760,740,720,690,660],
  "烏日區":[830,815,805,780,760,740,720,690,660],
  "大里區":[780,770,755,735,720,700,680,650,620],
  "太平區":[770,760,745,725,705,685,670,640,610],
  "潭子區":[770,760,745,725,705,685,670,640,610],
  "豐原區":[770,760,745,725,705,685,670,640,610],
  "霧峰區":[675,665,650,635,620,600,585,560,535],
  "大雅區":[675,665,650,635,620,600,585,560,535],
  "沙鹿區":[660,650,640,625,605,590,575,550,525],
  "龍井區":[660,650,640,625,605,590,575,550,525],
  "后里區":[660,650,640,625,605,590,575,550,525],
  "梧棲區":[660,650,640,625,605,590,575,550,525],
  "清水區":[600,590,580,565,550,535,520,500,475],
  "大肚區":[590,580,570,555,540,525,510,480,460],
  "神岡區":[600,590,580,565,550,535,520,500,475],
  "大甲區":[565,555,550,535,520,500,490,470,450],
  "外埔區":[505,500,490,475,465,450,440,420,400],
  "石岡區":[505,500,490,475,465,450,440,420,400],
  "東勢區":[495,485,480,465,455,440,430,410,390],
  "新社區":[445,440,430,420,410,400,385,370,355],
  "和平區":[445,440,430,420,410,400,385,370,355],
  "其它":[375,370,360,355,345,335,325,310,295]
};

// 屋齡對應欄位：0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40+
const AGE_BANDS = [4,9,14,19,24,29,34,39,999];
function bandIndex(age){
  for(let i=0;i<AGE_BANDS.length;i++){
    if(age<=AGE_BANDS[i]) return i;
  }
  return AGE_BANDS.length-1;
}

document.getElementById("rentForm").addEventListener("submit", e=>{
  e.preventDefault();

  const dist   = document.getElementById("district").value;
  const age    = Number(document.getElementById("age").value);
  const pings  = parseFloat(document.getElementById("pings").value);
  const current= Number(document.getElementById("currentRent").value);

  const resEl    = document.getElementById("result");
  const detailEl = document.getElementById("detail");
  const noteEl   = document.getElementById("note");

  // 依坪數自動判斷：套房 / 非套房（不顯示，只用來選表）
  const isStudio = pings <= 15 ? "studio" : "house";
  const table    = isStudio === "studio" ? STUDIO_TABLE : HOUSE_TABLE;
  const upperLimit = isStudio === "studio" ? 21000 : 35000;

  // 若超過單戶最高租金上限 → 直接無法承作
  if(current > upperLimit){
    resEl.textContent = "無法承作";
    resEl.className   = "result warn";
    detailEl.innerHTML =
      `（${isStudio==="studio"?"套房":"非套房"}租金上限 ${upperLimit.toLocaleString()} 元，`+
      `現在租金 <b>${current.toLocaleString()}</b> 元）`;
    noteEl.textContent = "以上試算結果僅供參考，最後結果將由審查單位認定";
    return;
  }

  const idx = bandIndex(age);
  const row = table[dist];
  if(!row){
    resEl.textContent = "";
    detailEl.textContent = "找不到此行政區的單價資料。";
    noteEl.textContent = "";
    return;
  }

  const priceBand    = row[idx];    // 該屋齡單價（元／坪）
  const priceBase    = row[0];      // 0–4 年基準單價（元／坪）
  const rateFromBase = priceBase ? (priceBand/priceBase - 1) : 0;

  const highest = Math.ceil(priceBand * pings);  // 最高租金（無條件進位）
  const pass    = highest >= current;

  resEl.textContent = pass ? "O" : "X";
  resEl.className   = "result " + (pass ? "ok" : "warn");

  let html =
    `租金區間（每坪）：<b>${priceBand}</b> 元／坪<br>`+
    `0–4 年基準單價：<b>${priceBase}</b> 元／坪<br>`+
    `調等率：<b>${(rateFromBase*100).toFixed(2)}%</b><br>`+
    `坪數：<b>${pings.toFixed(2)}</b> 坪<br>`+
    `最高租金（無條件進位）：<b>${highest.toLocaleString()}</b> 元<br>`+
    `現在租金：<b>${current.toLocaleString()}</b> 元`;

  detailEl.innerHTML = html;
  noteEl.textContent = "以上試算結果僅供參考，最後結果將由審查單位認定";
});
</script>
</body>
</html>
